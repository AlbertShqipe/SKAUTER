<div class="explore-layout" data-controller="explore-map">
  <!-- LEFT: LIST -->
  <aside class="explore-list">
    <h1>Explore Locations</h1>
    <p><%= @locations.count %> locations found</p>

    <div class="location-cards">
      <% @locations.each do |location| %>
        <div
          class="location-card"
          data-action="mouseenter->explore-map#hover"
          data-location-id="<%= location.id %>"
          data-lat="<%= location.latitude %>"
          data-lng="<%= location.longitude %>">

          <!-- IMAGE -->
          <div class="location-card-image">
            <% if location.cover_image.attached? %>
              <%= image_tag location.cover_image, alt: location.name %>
            <% end %>

            <span class="location-badge">
              <%= location.county.name %>
            </span>

            <%= render "favorites/heart", location: location %>
          </div>

          <!-- CONTENT -->
          <div class="location-card-body">
            <h3><%= location.name %></h3>

            <p class="location-address">
              <span class="icon">üìç</span>
              <%= location.address %>
            </p>

            <p class="location-description">
              <%= truncate(location.description, length: 140) %>
            </p>

            <div class="location-meta">
              <span>
                üë• Up to <%= location.capacity %> people
              </span>

              <% if location.price_per_hour.present? %>
                <span class="location-price">
                  ALL <%= location.price_per_hour %>
                  <small>per hour</small>
                </span>
              <% end %>
            </div>

            <%= link_to "View Details",
                  location_path(location),
                  class: "location-cta" %>

            <div class="location-tags">
              <% location.tags.first(3).each do |tag| %>
                <span class="tag"><%= tag %></span>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </aside>

  <!-- RIGHT: MAP -->
  <section
    class="explore-map"
    data-controller="map"
    data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>"
    data-map-markers-value="<%= json_escape(@markers.to_json) %>"
    data-map-counties-value="<%= json_escape(@county_markers.to_json) %>"
    data-map-target="container"
    <% if @selected_county %>
      data-map-selected-county-value="<%= json_escape({
        lat: @selected_county.latitude,
        lng: @selected_county.longitude
      }.to_json) %>"
    <% end %>>

  </section>
</div>
