<div class="location-show">

  <!-- Back link -->
  <div class="location-nav">
    <%= link_to "‚Üê Back to Explore", regions_path, class: "back-link" %>
  </div>

  <!-- Main grid -->
  <div class="location-grid">

    <!-- LEFT: Gallery + content -->
    <div class="location-main">

    <% images = @location.images.map { |img| url_for(img) } %>
    <% if @location.cover_image.present? %>
      <div class="location-hero">
        <%= image_tag @location.cover_image, alt: @location.name %>
      </div>
    <% else %>
        <%= image_tag "default.jpg", alt: "Default image" %>
    <% end %>

    <% if @location.images.present? %>
      <div class="location-images">
        <div class="location-gallery">
          <% @location.images.each_with_index do |image, index| %>
            <%= image_tag image,
              class: "clickable-image admin-image",
              data: {
                action: "click->lightbox#open",
                lightbox_images: images.to_json,
                lightbox_index: index
              } %>
          <% end %>
        </div>
      </div>
    <% end %>



      <!-- Hero image -->

      <!-- Title & meta -->
      <div class="location-header">
        <h1><%= @location.name %></h1>

        <p class="location-meta">
          üìç <%= @location.address %>
        </p>

        <div class="location-tags">
          <% @location.tags.each do |tag| %>
            <span class="tag"><%= tag %></span>
          <% end %>
        </div>
      </div>

      <!-- About -->
      <section class="location-section">
        <h2>About this location</h2>
        <p><%= @location.description %></p>
      </section>

      <!-- Amenities -->
      <section class="location-section">
        <h2>Amenities</h2>
        <ul class="amenities-list">
          <% @location.amenities.each do |amenity| %>
            <li>‚úì <%= amenity %></li>
          <% end %>
        </ul>

        <div class="location-activities">
          <% @location.activity_types.first(3).each do |activity| %>
            <span class="activity-pill"><%= activity %></span>
          <% end %>
        </div>
      </section>

    </div>

    <!-- RIGHT: Booking card -->

    <aside class="booking-card">
      <%= form_with model: [@location, Booking.new],
          data: {
          controller: "pricing booking-availability",
          booking_availability_url_value: location_availability_path(@location),
          pricing_hourly_value: @location.price_per_hour,
          pricing_daily_value: @location.price_per_day
        } do |f| %>

        <div class="price">
          <strong>
            <span class="currency">ALL</span>
            <span data-pricing-target="amount">
              <%= number_with_delimiter(@location.price_per_hour) %>
            </span>
          </strong>
          <span data-pricing-target="unit">/ hour</span>
        </div>

        <div class="pricing-toggle">
          <button
            type="button"
            class="active"
            data-pricing-target="hourlyBtn"
            data-action="click->pricing#showHourly">
            Hourly
          </button>

          <button
            type="button"
            data-pricing-target="dailyBtn"
            data-action="click->pricing#showDaily">
            Daily
          </button>
        </div>

        <div class="booking-info">
          <p>üë• Up to <%= @location.capacity %> people</p>
          <p class="available">‚úî Available for booking</p>
        </div>


        <% if user_signed_in? %>
          <%= f.hidden_field :booking_type, value: "hourly", data: { pricing_target: "type" } %>

          <!-- HOURLY FIELDS -->
          <div data-pricing-target="hourlyFields" class="pricing-fields">
            <div class="form-group hourly-field">
              <%= f.label :starts_at, "Start" %>
              <%= f.datetime_local_field :starts_at,
                  data: { booking_availability_target: "start", action: "change->booking-availability#update input->booking-availability#update" } %>
            </div>

            <div class="form-group hourly-field">
              <%= f.label :ends_at, "End" %>
              <%= f.datetime_local_field :ends_at,
                  data: { booking_availability_target: "end", action: "change->booking-availability#update input->booking-availability#update" } %>
            </div>
          </div>

          <!-- DAILY FIELDS -->
          <div data-pricing-target="dailyFields" class="pricing-fields" hidden>
            <div class="form-group daily-field">
              <%= f.label :starts_at, "Start date" %>
              <%= f.date_field :starts_at, required: true %>
            </div>

            <div class="form-group daily-field">
              <%= f.label :ends_at, "End date" %>
              <%= f.date_field :ends_at, required: true %>
            </div>
          </div>

          <% available_now = @location.available_for?(f.object.starts_at, f.object.ends_at) %>

          <%= f.submit "Request Booking",
                class: "btn-primary",
                disabled: true,
                data: { booking_availability_target: "submit" } %>

        <% else %>

          <%= button_to "Sign in to Book",
            new_user_session_path,
            method: :get,
            class: "btn-primary" %>

        <% end %>
      <% end %>

    </aside>

  </div>
  <section class="location-section host-section">
    <h2>Hosted by</h2>

    <div class="host-card">
      <div class="host-avatar">
        <span>S</span>
      </div>

      <div class="host-info">
        <div class="host-name">
          <strong>Skauter Team</strong>
          <span class="verified-badge">‚úî Verified</span>
        </div>

        <div class="host-rating">
          ‚≠ê 4.9 rating
        </div>
      </div>
    </div>
  </section>
</div>
