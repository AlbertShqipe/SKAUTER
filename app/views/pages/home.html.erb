<section>
  <div class="home-banner">

    <div class="hero__content">
      <div class="hero-text">
        <%= image_tag 'logo.png', class:"img-hero" %>
        <p>Book Albania's most cinematic filming locations</p>
      </div>

      <div id="hero-search" class="hero-search" data-controller="hero-search">
        <%= form_with url: regions_path, method: :get, class: "search-bar" do %>

          <!-- ACTIVITY -->
          <div class="search-field"
            data-action="click->hero-search#toggleActivity">

            <label class="search-label">What are you planning?</label>

            <div class="search-value">
              <i data-lucide="film"></i>
              <span data-hero-search-target="activityLabel">
                <%= params[:activity].presence || "Film Production" %>
              </span>
            </div>

            <div class="search-dropdown"
                data-hero-search-target="activityDropdown"
                hidden>

              <div class="dropdown-title">Select Activity Type</div>

              <% [
                "Film Production",
                "Photo Shoot",
                "Event",
                "Wedding",
                "Music Video",
                "Commercial",
                "Documentary",
                "Meeting"
              ].each do |activity| %>

                <button type="button"
                        class="dropdown-item"
                        data-value="<%= activity %>"
                        data-action="click->hero-search#selectActivity">
                  <span><%= activity %></span>
                  <span class="check"
                        data-hero-search-target="activityCheck"
                        data-check-for="<%= activity %>"
                        hidden>✓</span>
                </button>

              <% end %>
            </div>
          </div>

          <!-- WHERE -->
          <div class="search-field"
              data-action="click->hero-search#toggleLocationType">

            <label class="search-label">Where?</label>

            <div class="search-value">
              <i data-lucide="building-2"></i>
              <span data-hero-search-target="locationTypeLabel">
                <%= params[:location_type].presence || "Villas & Estates" %>
              </span>
            </div>

            <div class="search-dropdown"
                data-hero-search-target="locationTypeDropdown"
                hidden>

              <div class="dropdown-title">Select Location Type</div>

              <% Location.dynamic_location_type_groups.each do |group, types| %>
                <div class="dropdown-group">

                  <% types.each do |type| %>
                    <% display = type.to_s.titleize %>

                    <button type="button"
                            class="dropdown-item"
                            data-value="<%= display %>"
                            data-action="click->hero-search#selectLocationType">
                      <span><%= display %></span>

                      <span class="check"
                            data-hero-search-target="locationTypeCheck"
                            data-check-for="<%= display %>"
                            hidden>✓</span>
                    </button>
                  <% end %>
                </div>
              <% end %>

            </div>
          </div>

          <!-- WHEN -->
          <div class="search-field"
              data-action="click->hero-search#toggleDate">

            <label class="search-label">When?</label>

            <div class="search-value">
              <i data-lucide="calendar"></i>
              <span data-hero-search-target="dateLabel">
                <%= params[:date].presence || "Anytime" %>
              </span>
            </div>

            <div class="search-dropdown"
                data-hero-search-target="dateDropdown"
                data-action="click->hero-search#stopPropagation"
                hidden>

              <div class="dropdown-title">When are you planning?</div>

              <button type="button"
                      class="dropdown-item"
                      data-value=""
                      data-action="click->hero-search#selectDate">
                <span>Anytime</span>
              </button>


              <div class="dropdown-calendar">
                <input type="date"
                      class="date-input"
                      data-hero-search-target="startDateField"
                      data-action="change->hero-search#updateDateRange">

                <input type="date"
                      class="date-input"
                      data-hero-search-target="endDateField"
                      data-action="change->hero-search#updateDateRange">
              </div>


            </div>
          </div>

          <!-- Hidden inputs -->
          <%= hidden_field_tag :activity,
                params[:activity].presence || "Film Production",
                data: { hero_search_target: "activityInput" } %>
          <%= hidden_field_tag :location_type,
              params[:location_type],
              data: { hero_search_target: "locationTypeInput" } %>
          <%= hidden_field_tag :start_date,
                params[:start_date],
                data: { hero_search_target: "startDateInput" } %>

          <%= hidden_field_tag :end_date,
                params[:end_date],
                data: { hero_search_target: "endDateInput" } %>

          <!-- SUBMIT -->
          <div class="search-action">
            <button type="submit" class="search-button btn-gold-shimmer ">
              <i data-lucide="search"></i>
              Search
            </button>
          </div>

        <% end %>
      </div>
    </div>
  </div>
</section>
<section class="why-albania" data-controller="parallax" data-action="scroll@window->parallax#scroll">
  <div class="container">

    <header class="section-header">
      <h2>Why Albania?</h2>
      <p>3,000 years of history meets untamed natural beauty</p>
    </header>

    <div class="feature-grid">

      <div class="feature-card">
        <div class="feature-icon">
          <i data-lucide="map-pin"></i>
        </div>
        <h3>12 Counties</h3>
        <p>
          From the Accursed Mountains to the Ionian coast,
          every terrain imaginable.
        </p>
      </div>

      <div class="feature-card">
        <div class="feature-icon">
          <i data-lucide="film"></i>
        </div>
        <h3>31% Tax Incentive</h3>
        <p>
          Albania offers a competitive 31% film tax credit
          for qualified productions.
        </p>
      </div>

      <div class="feature-card">
        <div class="feature-icon">
          <i data-lucide="calendar"></i>
        </div>
        <h3>300 Days of Sun</h3>
        <p>
          Perfect weather conditions for year-round production.
        </p>
      </div>

    </div>
  </div>
</section>
<section class="home-regions">
  <div class="container">
    <header class="section-header">
      <h2>Explore by Region</h2>
      <p>Each county offers unique cinematic possibilities</p>
    </header>
    <div class="regions-grid">
      <% @counties.each do |county| %>
        <% if county.slug.present? %>
          <%= link_to region_path(county.slug), class: "region-card" do %>
            <div class="region-image">
              <% if county.cover_image.attached? %>
                <%= image_tag url_for(county.cover_image) %>
              <% else %>
                <%= image_tag "default.jpg", alt: county.name %>
              <% end %>

              <div class="overlay">
                <h3><%= county.name %></h3>
                <span>
                  <%= pluralize(county.locations_count.to_i, "location") %>
                </span>
              </div>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
</section>
<section class="explore-by-type">
  <div class="container">
    <header class="section-header">
      <h2>Explore by Type</h2>
      <p>Find the perfect location for your production needs</p>
    </header>

    <div class="type-grid">
      <% @location_type_counts.each do |label, count| %>
        <%= link_to regions_path(type: label), class: "type-card" do %>

          <div class="type-image"
              style="background-image: url(<%= asset_path(Location::LOCATION_TYPE_IMAGES[label]) %>)">
            <div class="overlay">
              <h3><%= label %></h3>
              <span><%= pluralize(count, "location") %></span>
            </div>
          </div>

        <% end %>
      <% end %>
    </div>
  </div>
</section>
<%= render "shared/cta_footer" %>
<div
  data-controller="map"
  data-map-api-key-value="<%= @mapbox_api_key %>"
  data-map-markers-value="<%= json_escape(@markers.to_json) %>"
  data-map-open-value="false">

  <button
    class="map-toggle-btn btn btn-navbar btn-gold-shimmer"
    data-action="click->map#toggle"
    aria-label="Toggle map">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">
      <path d="M12 21C15.5 17.4 19 14.1764 19 10.2C19 6.22355 15.866 3 12 3C8.13401 3 5 6.22355 5 10.2C5 14.1764 8.5 17.4 12 21Z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M12 13C13.6569 13 15 11.6569 15 10C15 8.34315 13.6569 7 12 7C10.3431 7 9 8.34315 9 10C9 11.6569 10.3431 13 12 13Z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>

  <div class="map-panel" data-map-target="panel">
    <!-- HEADER -->
    <div class="map-header">
      <div>
        <h3>Explore Albania</h3>
        <span><%= @locations.count %> locations</span>
      </div>

      <button
        class="map-close-btn"
        data-action="click->map#toggle"
        aria-label="Close map">
        ✕
      </button>
    </div>
    <div class="map" data-map-target="container"></div>
  </div>

</div>
